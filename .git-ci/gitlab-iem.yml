---
include:
  - https://git.iem.at/pd/iem-ci/raw/main/pd-lib-builder/gitlab-iem.yml

pages:
  image: registry.gitlab.com/pages/hugo:latest
  stage: build
  script:
    - cd .hugo
    - touch generated.toml
    - test ! -x scripts/makeextraconfig.sh || scripts/makeextraconfig.sh > generated.toml
    - hugo --config=config.toml,generated.toml
    - mv public ..
  artifacts:
    paths:
      - public
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      changes:
        - .hugo/**/*
        - documentation/**/*
    - when: never

# # only run other jobs if there are changes outside the documentation directories
# .run-selected:
#   rules:
#     - if: '$IEM_CI_JOBS == "" || $CI_JOB_NAME =~ $IEM_CI_JOBS'
#       changes:
#         - "!.hugo/**/*"
#         - "!documentation/**/*"
#     - if: '$IEM_CI_JOBS == "" || $CI_JOB_NAME =~ $IEM_CI_JOBS'
#       changes:
#         - "*"
#         - "**/*"
#         # Exclude docs
#         - "!.hugo/**/*"
#         - "!documentation/**/*"
#     - when: never
