LIBNAME = iemmatrix
EXT = dll

PDPATH=/tmp/pd

CC = i586-mingw32msvc-gcc
LD = i586-mingw32msvc-ld
STRIP = i586-mingw32msvc-strip

DEFS = -DPD
IFLAGS = -I. -I$(PDPATH)/src

AFLAGS = 
LFLAGS = -export_dynamic -shared
WFLAGS =

.SUFFIXES: .$(EXT)

CFLAGS = -g -O2 $(DEFS) $(IFLAGS) $(WFLAGS) -mms-bitfields

LIBS = -L$(PDPATH)/bin/ -lpd -lcrtdll -lm


include Make.source
TARGETS = $(SOURCES:.c=.o)


all: $(LIBNAME)
	cp $(LIBNAME).$(EXT) ..

$(LIBNAME): $(TARGETS)
	$(LD) $(LFLAGS) *.o $(LIBS)  -o $(LIBNAME).$(EXT)
	$(STRIP) --strip-unneeded $(LIBNAME).$(EXT)

clean:
	-rm -f *.$(EXT) *.o 

cleaner: clean
	-rm -f *~ _* config.*

source:
	echo "SOURCES = \\"> Make.source
	echo `ls mtx_*.c $(LIBNAME).c` >> Make.source
	echo >> Make.source
